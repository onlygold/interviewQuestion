---
typora-copy-images-to: image
---

# Git

### 今日目标.

```
1. 掌握git的基本概念.
2. 掌握git命令操作本地仓库.
3. 掌握git的分支.
4. 掌握git的冲突处理.
4. 掌握git在远程仓库的操作.
5. 掌握在idea工具中使用git.
```

# 一. Git介绍及安装.

### 1. 什么是版本控制系统.

```
现在做开发时,一个项目从构建到完成需要经历很多的过程,为了管理好中间的各个版本,期间出现了很多种管理方式.
1. 原始的版本控制.
	在写项目时,比如完成了一个功能,就在本地复制一份项目的副本,通过不同的文件夹切换到不同的版本.
	但是这种方式会出现大量的文件,如果项目的周期长,会陷入版本管理的混乱中.
2. 本地化的版本控制.
	引入一些管理软件,帮助管理多个版本. 避免出现版本过多导致的问题.
	但是这种方式仅限于个人使用,无法多人协同开发.
3. 集中化的版本控制.
	一个版本服务器,多个贡献者,贡献者可以从服务器上下载别人的代码,也可以将自己的代码提交到服务器.如CVS和SVN.
	但是这种方式为集中式管理,如果服务器宕机,会导致单点故障,无法正常工作.
4. 分布式的版本控制.
	多个贡献者都有自己本地的版本控制,同时也可通过一个服务器共享彼此的代码. 是本地化管理和集中式管理的汇总.不会出现单点问题,不依赖于服务器,不依赖网络. 代表的工具 # Git
```

### 2. Git介绍.

![1557296760335](image/1557296760335.png)

```
Git是一个开源的分布式版本控制工具.
Git是Linus为了更好的管理Linux系统内核而开发出的一个开源的版本控制软件.
Git 易于学习,占地面积小,具有闪电般快速的性能.它超越了Subversion,CVS等版本控制工具，具有廉价本地分支及合并,便捷的临时区域和多个工作流程等功能.
```



### 3. Git下载并安装..

Git官网: https://git-scm.com/	

![1557297079297](image/1557297079297.png)

```
下载Git后,安装也是傻瓜式安装,只需要指定一下安装的目录即可.
安装成功后,测试.
```

![1557297144351](image/1557297144351.png)

# 二. Git的架构.

![1557297747084](image/1557297747084.png)

```
工作区: 就是项目目录,我们写代码的地方.
本地仓库: 添加Git本地仓库后,指定的目录会生成一个.git的隐藏目录,这个就是本地仓库.不对别人共享.
暂存区: 本地仓库中有一个临时区域,用于保存下一步要commit的文件.
分支: 本地仓库中包含若干分支,commit的代码保存在分支中.
远程仓库: 统一的版本服务器,多人共享一个.
```

# 三. 使用Git命令操作本地仓库.

```sh
1. 第一次安装完git之后,需要在git上设置一下自己的信息,以便后期协同开发时,知道都是谁的操作.
git config -l # 查看个人信息
git config --global user.name "xxx" # 设置个人姓名
git config --global user.email "xxx" # 设置个人邮件
git config --global --replace-all user.name "yyyy" # 如果需要修改,替换个人信息
```

```sh
2. 来一波基操,准备一个工作的项目目录,添加git的本地仓库,并将代码提交到git的本地仓库.
创建一个目录,添加一个.java文件.比如说HelloWorld.
git init # 为当前目录添加Git本地仓库 (添加成功会看到.git的隐藏目录)
git add 文件名|目录名|. # 将指定文件 | 目录 | 当前目录全部内容 添加到暂存区.(没有提示就是正确的)
git commit -m "提交信息" # 将暂存区内容提交到分支.(默认操作的是master分支,且默认只有一个)
```

```sh
3. 文件存放到本地仓库的master分支后,我们可以继续对其进行一些简单操作.
git status # 如果哪个文件有变化,工作区与本地分支不一致,可以直接查看到.
git diff 文件名 # 查看文件的变化内容.
如果需要将内容的变动提交到本地分支, 还需要add和commit操作.
git log # 可以查看到commit的日志,只查看本次提交以及之前的信息.
git checkout 唯一标识 # 可以跳转到指定的提交版本,并会将工作区的内容改变.但不会删除之前的commit版本.
会根据游标(HEAD)的移动,跳转到指定的提交点.
git reflog # 查看全部提交信息.
git rm 文件名 # 删除文件. 需要Commit后才会删除本地仓库分支的文件.
```

```
4. 快照
	git每次提交时,并不是赋值全部的文件,没有改动的文件只是记录一个链接.
```

![1557308227818](image/1557308227818.png)

# 四. 分支. 

### 1. 分支概述.

分支效果图.

![1557305991542](image/1557305991542.png)

```
1. 默认情况下只有一个分支master.
2. 分支特点:
	分支上有一个类似指针的效果,随之不断的commit,指针也会不断的向后移.
	分支默认总是指向最后一个提交点.
	获取分支数据时,就是在获取指针指向的数据.
```

### 2. 分支的应用场景.

```
在编写一个功能时,如果需要一周的时间,在一周的时间内会有多次的提交,但是会发现提交时,会将一些有错误的记录也保存在master分支中,导致master分支很混乱.
如果是多人协同开发,都向master分支提交就更麻烦了.
在实际开发中,我们要避免master分支被污染,只存放稳定的代码.

有两种方案:
	方案1: 一周不提交代码,保证代码完全正确后再提交代码到master分支.
		缺点:	一直不提交,导致缺少版本控制点.
	方案2: 在需要编写新功能时,创建一个新的分支.在这个新分支上完成功能后,再将这个新分支的内容合并到master上.这样可以多版本开发,又可以保证master分支不被污染.	
```

1. 创建新分支![1557306862357](image/1557306862357.png)
2. 在新分支上提交.![1557306912435](image/1557306912435.png)
3. 功能完成后合并到master分支,新分支也就可以删除掉了.![1557306970637](image/1557306970637.png)

### 3. 创建-切换分支.

```sh
git branch 分支名 # 创建新的分支.  新创建的分支会和当前分支保持一样的状态.
git checkout 分支名 # 切换到指定分支.
git branch -vv #  查看全部分支信息.
#在新分支情况下,修改文件内容,并add + commit提交到新分支中.
```

### 4. 合并删除.

```sh
git checkout master # 切换会master分支下.
git merge 新分支 # 将之前创建的新分支的内容合并到master分支中.
# 合并之后新分支就没有意义了,可以删除.
git branch --merged # 查看当前分支合并过的分支, 避免分支没合并就被删除.
git branch -d 分支名 # 删除制定分支
```

### 5. 解决冲突.

```
先手动的来一波冲突的出现.
在master下创建一个新的分支,并切换到新分支.
在新分支中,操作文件在最后添加Hello CHINA.
再切换会master分支下,在文件的最后添加Hey China.
再通过master合并新分支.
```

![1557316846116](image/1557316846116.png)

```java
// 会发现合并分支失败.因为两次操作修改的位置一样,但是内容不一样,git不知道删哪个留哪个,需要我们手动操作.
public Class HelloWord{
	public static void main(String[] args){
		System.out.println("Hello Git Git Git!!");
	}

	public void test(){
		System.out.print("我是newB分支下添加的方法...");
<<<<<<< HEAD
		System.out.print("Hey China");
=======
		System.out.print("Hello CHINA");
>>>>>>> newBranch
	}
}
/*
git会将有冲突的代码用<<<<<<<      =======      >>>>>>>分割开.
我们可以手动解决
*/
public Class HelloWord{
	public static void main(String[] args){
		System.out.println("Hello Git Git Git!!");
	}

	public void test(){
		System.out.print("我是newB分支下添加的方法...");
		System.out.print("Hello China");
	}
}
// 这是修改后的内容.
```

```sh
修改完毕后
git add . #在master上将冲突文件重新提交到暂存区.
git commit -m "解决冲突~" #将处理完毕的重新提交到本地仓库的分支,这时master分支和新分支都会被修改.
#############################################################
git merge --abort # 如果冲突太多,不想合并,可以执行,取消合并.
```

# 五. Git操作远程仓库.

```
Git的远程仓库就是多人协同开发时的共享库.
多人在本地开发完功能后,推送的远程仓库,最终远程仓库有就有了一个完整的项目.
远程仓库有多重方式,git提供了安装远程仓库的方式gitlab.
不过网上已经有很多提供好的远程仓库.比如github,和gitee.
这里我们采用gitee作为远程仓库(中文比较爽).
```

### 1. 设置SSH.

```sh
由于使用的是黑窗口操作,需要使用SSH方式链接远程仓库.
ssh-keygen -t rsa -C "zjw_2301211@126.com" # 一顿回车. 生成公钥和私钥.
最后会生成在你用户目录的.ssh目录中.
会生成一个私钥id_rsa和一个公钥id_rsa.pub
```

### 2. gitee.设置公钥

gitee的首页: http://gitee.com.

注册登录就不说了,最好用个邮箱.

![1557315598162](image/1557315598162.png)

![1557315702414](image/1557315702414.png)

### 3. 创建远程仓库.

![1557315803642](image/1557315803642.png)

![1557315962824](image/1557315962824.png)

![1557316015860](image/1557316015860.png)



### 4. 本地仓库关联远程仓库.

```sh
# 添加远程仓库
git remote add origin git@gitee.com:zhengdaxian/my_first_warehouse.git
# remote远程,  add添加,  origin是远程仓库的别名 origin也是默认的别名
# 也可以添加远程仓库并起别名
git remote add myName git@gitee.com:zhengdaxian/my_first_warehouse.git
#############################################
git remote -v #查看关联的所有远程仓库.
git remote show origin # 关联远程仓库后, 本地分支和远程分支的对应关系.
git remote remove 远程仓库别名 # 删除关联仓库
git remote rename 远程仓库别名  新远程仓库别名  # 更换关联的远程仓库别名
```

### 5. 将本地仓库内容推送到远程仓库.

```sh
#将本地仓库分支上的内容推送到远程仓库的分支上.
git push origin master	# 将master分支上的内容推送到远程仓库的分支上.(如果分支不存在会创建一个)
git push origin test:test	# 将本地分支test上内容远程仓库的test分支.
# Ps 要保证在推送到远程仓库时有指定权限,以及版本与远程仓库保持一致.
```

### 6. 将远程仓库内容拉取并合并到本地分支.

```sh
# 将远程仓库分支上的内容拉取到本地仓库的一个远程分支中.
git fetch origin master # git fetch 远程仓库别名 分支名.
# 远程仓库的内容会拉取到本地仓库的一个分支中,分支默认名为 origin/master(远程仓库分支)
git merge origin/master # 合并分支 (可能会出现冲突,解决方案同上解决冲突).
###########################################
git pull origin master == git fetch + git merge
# 拉取远程仓库内容并直接合并.
```

### 7. 下载远程仓库内容.

```sh
在本地没有任何环境,可以先从远程仓库下载环境.
# 如果是ssh方式
git clone git@gitee.com:zhengdaxian/my_first_warehouse.git
# 或者是http方式
git clone git@gitee.com:zhengdaxian/my_first_warehouse.git
# 直连链接的路径不一样.
```

### 8. 协同工作流程.

```
第一步.
	由项目经理创建一个远程库.
	在本地创建一个git本地仓库(git init).并设置指定分支.
	将本地仓库和远程仓库关联.
	将本地环境推送到远程仓库.
	将其他开发人员拉到远程仓库的开发者中.
	并将远程仓库的master分支设置为被保护的,避免其他开发人员操作远程仓库master分支.
第二步.
	由开发人员git clone拉取远程仓库内容.
	切换到指定分支.并在开发完某个功能后add + commit + push,如果push失败记得fetch + merge 或者 pull
	等每个开发人员的工作分支都完成后,并且测试没毛病,由经理将所有内容merge到一个分支中.测试后再合并到master分支,任务完成.
```

# 六. 在IDEA中使用Git操作.

### 1. 在idea中关联git.exe文件.

![1557375344460](image/1557375344460.png)

### 2. 创建maven项目.并通多idea关联git.

![1557375461114](image/1557375461114.png)

### 3. 在idea中maven项目需要忽略的内容.

```
在maven项目中值有src目录和pom.xml需要提供.
想其他的.idea目录,xxx.iml文件,以及target目录都是不需要提交的.
我们需要在提交到本地仓库以及远程仓库时,需要忽略掉.
```

![1557375593767](image/1557375593767.png)

### 4. 安装ignore插件.

![1557375672510](image/1557375672510.png)

```
我的最右侧显示的是update更新,没安装过显示的是绿色的install按钮.
```

### 5. 添加忽略项.

```
安装成功后,可以在项目中创建.gitignore文件
```

![1557375750111](image/1557375750111.png)

```
添加文件后,可以手动添加忽略项,也可以使用提供的模板.
```

![1557375848719](image/1557375848719.png)

```
添加完毕后,被忽略的文件会颜色变浅,或者直接隐藏.
右键可以选择展示或者隐藏被忽略的文件.
```

![1557375894590](image/1557375894590.png)

### 6. add + commit.

```
可以添加一个类,然后add + commit 操作.
```

![1557375955437](image/1557375955437.png)

```
再次点击Add上面的Commit之后,就会弹出如下窗口,提交单本地仓库,并添加提交信息.
```

### 7. 创建远程仓库.

```
同上操作.
```

### 8. idea中本地仓库关联远程仓库

![1557381212511](image/1557381212511.png)

![1557381241619](image/1557381241619.png)

```
复制远程仓库中的Https的仓库地址.
```



### 9. push + pull.

```
可以在idea中使用push推送代码或者pull拉取并合并代码.
```

![1557376208523](image/1557376208523.png)

```
在使用git进行pull或者merge时会出现
refusing to merge unrelated histories 的问题,
需要在命令行中使用
git pull origin master --allow-unrelated-histories. 后续就不会出现问题啦.

也在可以在关键远程仓库是,创建裸仓库,不带readME,也不会出现这个问题.
```





